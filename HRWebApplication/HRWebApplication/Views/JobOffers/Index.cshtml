@*@model HRWebApplication.Services.PaginatedList<HRWebApplication.Models.JobOffers>*@

@{
    ViewData["Title"] = "Job Offers";
}

<div class="mt-5 row">
    <div class="col-md-4 text-md-left">
        <h3 class="font-weight-bold">
            Job Offer list
        </h3>
    </div>
    <div class="col-md-4 text-md-center">
        <p>Search window</p>
    </div>
    <div class="col-md-4 text-md-right">
        <a asp-action="Create" class="btn btn-outline-primary rounded-pill">
            <i class="fa fa-plus pr-2"></i>
            Add Job Offer
        </a>
    </div>
</div>
<div class="table-responsive-sm">
    <table class="table table-striped table-hover" >
        <thead>
            <tr>
                <th scope="col" style="min-width: 100px">Job Title</th>
                <th scope="col">Company</th>
                <th scope="col">Location</th>
                <th scope="col" class="text-center">Salary Range</th>
                <th style="width: 20px"></th>
            </tr>
        </thead>
        <tbody id="jobOffersTable">
        </tbody>
    </table>
</div>

<div class="d-flex justify-content-between align-items-center">
    <div>
        <span>
            Show
            <select id="pageSizeSelect" class="ml-1 mr-1" onchange="fetchData(1, this.options[this.selectedIndex].value)">
                <option value="1">1</option>
                <option value="10">10</option>
                <option value="30">30</option>
                <option value="50">50</option>
            </select>
            entries
        </span>
    </div>
    <div>
        <ul class="pagination" id="pageList"></ul>
    </div>
</div>


@section Scripts {
<script>
    var p_pageNumber = 1;
    var p_pageSize = 10;
    var currentPage = p_pageNumber;

    $(document).ready(function () {
        fetchData(p_pageNumber, p_pageSize);        
    });

    function fetchData(pageNumber, pageSize) {
        var $loading = '<tr><td><div class="spinner-border text-info"/></td> <td colspan="3">Please wait...</td></tr>';
        $('#jobOffersTable').prepend($loading);
        $.ajax({
            url: 'api/JobOffersApi',
            type: 'GET',
            data: { pageNumber: pageNumber, pageSize: pageSize },
            dataType: 'json',
            success: function (data) {
                currentPage = pageNumber;
                p_pageSize = pageSize;

                var $tableBody = $('<tbody id="jobOffersTable"/>');

                //console.log(data);

                $.each(data.collection, function (key, item) {
                    var $row = $('<tr/>');
                    $row.append($('<td/>').append($('<a href="/JobOffers/Details/' + item.jobOfferId + '"/>').append(item.jobTitle)));
                    //console.log($row);
                    $row.append($('<td/>').append(item.company.companyName));
                    $row.append($('<td/>').append(item.location));
                    $row.append($('<td/>').addClass('text-center').append(item.salaryFrom + '-' + item.salaryTo));
                    $row.append($('<td/>').append($('<a href="/JobOffers/Edit/' + item.jobOfferId + '"/>').addClass('text-primary').append($('<i title="Edit"/>').addClass('fas fa-edit'))));
                    $tableBody.append($row);
                });
                $('#jobOffersTable').replaceWith($tableBody);

                var $pagelistBody = $('<ul class="pagination" id="pageList"/>');
                var $btn1 = $('<li/>');
                var $btn2 = $('<li/>');
                var $btn3 = $('<li/>');
                var $btn4 = $('<li/>');
                var $btn5 = $('<li/>');
                $btn1.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber - 1) + ',' + pageSize + ')">Previous</button>');
                $btn5.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber + 1) + ',' + pageSize + ')">Next</button>');
                if (pageNumber == 1) {
                    $btn1.addClass('disabled');
                    $btn2.addClass('page-item active').append('<button class="page-link" onclick="fetchData(' + pageNumber + ',' + pageSize + ')">' + pageNumber + '</button>');
                    $pagelistBody.append($btn1);
                    $pagelistBody.append($btn2);
                    if (data.totalPages == 1) {
                        $btn5.addClass('disabled');
                    }
                    else if (data.totalPages == 2) {
                        $btn3.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber + 1) + ',' + pageSize + ')">' + (pageNumber + 1) + '</button>');
                        $pagelistBody.append($btn3);
                    }
                    else {
                        $btn3.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber + 1) + ',' + pageSize + ')">' + (pageNumber + 1) + '</button>');
                        $btn4.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber + 2) + ',' + pageSize + ')">' + (pageNumber + 2) + '</button>');
                        $pagelistBody.append($btn3);
                        $pagelistBody.append($btn4);
                    }
                    $pagelistBody.append($btn5);
                }
                else if (pageNumber == data.totalPages) {
                    $btn5.addClass('disabled');
                    $btn4.addClass('page-item active').append('<button class="page-link" onclick="fetchData(' + pageNumber + ',' + pageSize + ')">' + pageNumber + '</button>');
                    if (data.totalPages == 1) {
                        $btn1.addClass('disabled');
                        $pagelistBody.append($btn1);
                        $pagelistBody.append($btn4);
                        $pagelistBody.append($btn5);
                    }
                    else if (data.totalPages == 2) {
                        $btn3.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber - 1) + ',' + pageSize + ')">' + (pageNumber - 1) + '</button>');
                        $pagelistBody.append($btn1);
                        $pagelistBody.append($btn3);
                        $pagelistBody.append($btn4);
                        $pagelistBody.append($btn5);
                    }
                    else {
                        $btn2.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber - 2) + ',' + pageSize + ')">' + (pageNumber - 2) + '</button>');
                        $btn3.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber - 1) + ',' + pageSize + ')">' + (pageNumber - 1) + '</button>');
                        $pagelistBody.append($btn1);
                        $pagelistBody.append($btn2);
                        $pagelistBody.append($btn3);
                        $pagelistBody.append($btn4);
                        $pagelistBody.append($btn5);
                    }
                }
                else {
                    $btn2.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber - 1) + ',' + pageSize + ')">' + (pageNumber - 1) + '</button>');
                    $btn3.addClass('page-item active').append('<button class="page-link" onclick="fetchData(' + pageNumber + ',' + pageSize + ')">' + pageNumber + '</button>');
                    $btn4.addClass('page-item').append('<button class="page-link" onclick="fetchData(' + (pageNumber + 1) + ',' + pageSize + ')">' + (pageNumber + 1) + '</button>');
                    $pagelistBody.append($btn1);
                    $pagelistBody.append($btn2);
                    $pagelistBody.append($btn3);
                    $pagelistBody.append($btn4);
                    $pagelistBody.append($btn5);
                }

                $('#pageList').replaceWith($pagelistBody);
            },
            error: function () {
                    alert('Error! Please try again.');
            }
        }).done(function () {

        });
    }
</script>
}
